# Задание 3

**Флаг**: NQ2024082dc42286a3fa73f75edb5e99ca418aeb8a733458e6dd3df74064548c1c97a

Картинка представляет собой фото Ричарда Уэсли Хэмминга (рис. 1), дополненное некоторой информацией, которая поможет в получении флага.

**Входные данные**: файл с названием «message.png» – изображение, содержащее скрытую информацию (задание на стеганографию).

![https://sun9-25.userapi.com/impg/kuXRSkHbD-TjVMP2EMNWPelA19n_SYp3Wxiy7A/fhT7nKtKOr0.jpg?size=793x664&quality=95&sign=b9c6d15d018bc2eb04dd7a5222df3c8b&type=album](https://sun9-25.userapi.com/impg/kuXRSkHbD-TjVMP2EMNWPelA19n_SYp3Wxiy7A/fhT7nKtKOr0.jpg?size=793x664&quality=95&sign=b9c6d15d018bc2eb04dd7a5222df3c8b&type=album)

Рисунок 1 – Ключевая информация на исходном изображении

Для сокрытия информации в картинке использовался принцип использования младших бит данных (LSB), а также позиции контрольных битов кода Хэмминга. Подсказка к этому содержится на изображении – надпись LSB и стрелки, демонстрирующие порядок прохода со смещениями, а также то, что каждый порядковый бит отвечает за отдельную текстовую последовательность (всего таких последовательностей 4 – на каждый из младших битов). Надпись print говорит о том, что скрытые символы являются отображаемыми. Схема, на которую Хэмминг указывает, об используемой цветовой схеме и порядке использования байт одного пикселя.

Таким образом, в четырех младших битах байт данных, в соответствии с позициями кода Хэмминга, хранятся отображаемые символы. Каждый бит участвует в формировании текстовой последовательности своего “уровня” (рис. 2).

![https://sun9-61.userapi.com/impg/s_3iLBu9SzdLiNfDLrr8XL0_ojR33R2dvoLg-A/ZvWBqMevZPI.jpg?size=807x245&quality=95&sign=73b7cc43a103f210f1d56e1111b1deaf&type=album](https://sun9-61.userapi.com/impg/s_3iLBu9SzdLiNfDLrr8XL0_ojR33R2dvoLg-A/ZvWBqMevZPI.jpg?size=807x245&quality=95&sign=73b7cc43a103f210f1d56e1111b1deaf&type=album)

Рисунок 2 – Позиции значимых бит, нужных для получения текстовых последовательностей

В конечном итоге среди всех полученных строк необходимо найти несколько частей флага, явно обозначенных префиксом и суффиксом PART (рис. 3). Для поиска частей флага можно использовать утилиту strings.

![https://sun9-54.userapi.com/impg/RSE53lTYIS4ltBi7_R9IwWFCzsQ09P8BUSrDlg/ILyo6QcymzY.jpg?size=807x113&quality=95&sign=25b1fec9d9c646164b84ab19ec4a7d54&type=album](https://sun9-54.userapi.com/impg/RSE53lTYIS4ltBi7_R9IwWFCzsQ09P8BUSrDlg/ILyo6QcymzY.jpg?size=807x113&quality=95&sign=25b1fec9d9c646164b84ab19ec4a7d54&type=album)

Рисунок 3 – Содержание части флага в текстовом выводе одной из последовательностей

Итоговый код для выполнения задания может выглядеть следующим образом.

from PIL import Image

INDECES_LIST = [

[ 0, 2, 4, 6, 8, 10, 12, 14 ],

[ 1, 2, 5, 6, 9, 10, 13, 14 ],

[ 3, 4, 5, 6, 11, 12, 13, 14 ],

[ 7, 8, 9, 10, 11, 12, 13, 14 ]

]

def perform_destega(inpath: str, outpath: str) -> None:

im = Image.open(inpath).convert('RGBA')

pixels = im.load()

w, h = im.size

handled_bytes: list[int] = [ ]

for i in range(w):

for j in range(h):

handled_bytes += bytearray(pixels[i, j])

stega_strings: list[str] = [ ]

stega_levels = len(INDECES_LIST)

for i in range(stega_levels):

stega_string = ''

for j in range(0, len(handled_bytes), 2 ** stega_levels):

value = 0

for index in INDECES_LIST[i]:

value = (value << 1) | ((handled_bytes[j + index] >> i) & 1)

stega_string += chr(value)

stega_strings.append(stega_string)

with open(outpath, 'w') as of:

for stega_string in stega_strings:

of.write(stega_string)

perform_destega('picture.png', 'ofile.txt')