# Задание 6

Флаг: NQ2024ca34147d5a36bb4e9601dd7de1308cb69057ad4a05b2840d9ccc6661abef391a

Задание развернуто на двух портах: 15000 и 8000. На порту 8000 развернут интерфейс управления банкоматом, на 15000 – личный кабинет банка.

Для входа в интерфейс веб-приложения на порту 8000 необходим токен, которого изначально не дано. Попытки фаззинга поля ввода токена не приводят к обходу аутентификации.

Зато на порту 15000 есть возможность регистрации пользователя.

![https://sun9-26.userapi.com/impg/8BonobFldoRSzpuGAwflTm0ItUy6QwdulVAdpw/5xX6IQSBIPI.jpg?size=807x311&quality=95&sign=2a320c2322d6809abd5ceb4051dbe5fe&type=album](https://sun9-26.userapi.com/impg/8BonobFldoRSzpuGAwflTm0ItUy6QwdulVAdpw/5xX6IQSBIPI.jpg?size=807x311&quality=95&sign=2a320c2322d6809abd5ceb4051dbe5fe&type=album)

Проходим регистрацию с любыми учетными данными.

![https://sun9-26.userapi.com/impg/zjZbQyVfZl4THAQYy3F43xFdLeXAauLRuLmhhQ/TASe8qzkqLk.jpg?size=807x314&quality=95&sign=e3785d99740b3b73dce3c32514dbb014&type=album](https://sun9-26.userapi.com/impg/zjZbQyVfZl4THAQYy3F43xFdLeXAauLRuLmhhQ/TASe8qzkqLk.jpg?size=807x314&quality=95&sign=e3785d99740b3b73dce3c32514dbb014&type=album)

Входим под заданными реквизитами для входа.

![https://sun9-42.userapi.com/impg/boaX1ABUhRn_K1ecWk7xjkj5KT2UwY8bizpYjA/pV7874LMOEM.jpg?size=807x269&quality=95&sign=e210926956b427b74684814f373cacc4&type=album](https://sun9-42.userapi.com/impg/boaX1ABUhRn_K1ecWk7xjkj5KT2UwY8bizpYjA/pV7874LMOEM.jpg?size=807x269&quality=95&sign=e210926956b427b74684814f373cacc4&type=album)

После входа замечаем запрос на конечную точку /users/ с параметром filtering. Замечаем совпадение значения параметра filtering, user_id в cookie и id из возвращаемого json.

![https://sun9-77.userapi.com/impg/YTHO1yJ9mfxgCbNGqspq5VFVWmvYCsyikrqgGA/Ip061NLZD8A.jpg?size=807x312&quality=95&sign=240b554e175963c841fddd4229e6dc9e&type=album](https://sun9-77.userapi.com/impg/YTHO1yJ9mfxgCbNGqspq5VFVWmvYCsyikrqgGA/Ip061NLZD8A.jpg?size=807x312&quality=95&sign=240b554e175963c841fddd4229e6dc9e&type=album)

Осуществляем попытку эксплуатации IDOR через подмену значения параметра filtering. Однако посмотреть данные другого пользователя таким образом не получается.

![https://sun9-44.userapi.com/impg/jJVZBBndtxdJ_JrPySypAMgN4k-i3-T5o3HKDw/LD4KbakSacw.jpg?size=807x250&quality=95&sign=ac7952db3bc74ba63f943cc54b477fc3&type=album](https://sun9-44.userapi.com/impg/jJVZBBndtxdJ_JrPySypAMgN4k-i3-T5o3HKDw/LD4KbakSacw.jpg?size=807x250&quality=95&sign=ac7952db3bc74ba63f943cc54b477fc3&type=album)

Убираем параметр filtering и пробуем повторить запрос. Однако сервис требует наличие данного параметра.

![https://sun9-51.userapi.com/impg/lXMdpQ6i8rxwc135UhwM4xQjgRU6DksvKL2JdQ/oSvimS9LpGo.jpg?size=807x196&quality=95&sign=5aefe2c3a7c4600db4b871013286574d&type=album](https://sun9-51.userapi.com/impg/lXMdpQ6i8rxwc135UhwM4xQjgRU6DksvKL2JdQ/oSvimS9LpGo.jpg?size=807x196&quality=95&sign=5aefe2c3a7c4600db4b871013286574d&type=album)

Передаем его, но с пустым значением. Получаем данные всех пользователей – IDOR все-таки допущен разработчиками. Можем заметить service_token пользователя administrator.

![https://sun9-76.userapi.com/impg/6d_n4lhLLeW47sW1BN_z_2Yu3jTWo7UgJbH1mw/hh3n1Adm8og.jpg?size=807x374&quality=95&sign=57646ae87482a88661ddd47d4b7f65fb&type=album](https://sun9-76.userapi.com/impg/6d_n4lhLLeW47sW1BN_z_2Yu3jTWo7UgJbH1mw/hh3n1Adm8og.jpg?size=807x374&quality=95&sign=57646ae87482a88661ddd47d4b7f65fb&type=album)

Заходим в раздел «О нас» и находим описание руководящего состава. Среди них – Генри Кавилл, главный технический **администратор**!

![https://sun9-26.userapi.com/impg/BxtXu7IKIjzKNN8zLf1qHSBDWnJ3maH4Vdlzow/x6VZ9_HFttI.jpg?size=807x416&quality=95&sign=8bda899f706520d621ee04035ea6020a&type=album](https://sun9-26.userapi.com/impg/BxtXu7IKIjzKNN8zLf1qHSBDWnJ3maH4Vdlzow/x6VZ9_HFttI.jpg?size=807x416&quality=95&sign=8bda899f706520d621ee04035ea6020a&type=album)

Попробуем зайти с полученным токеном под этим пользователем.

![https://sun9-2.userapi.com/impg/5Ewf3fH-ZEjMroFScwjTPjB-DpihAgon08UW-g/W5j4jN29x3g.jpg?size=807x628&quality=95&sign=ad6798fb5ae0d65313c31c406dbc3abf&type=album](https://sun9-2.userapi.com/impg/5Ewf3fH-ZEjMroFScwjTPjB-DpihAgon08UW-g/W5j4jN29x3g.jpg?size=807x628&quality=95&sign=ad6798fb5ae0d65313c31c406dbc3abf&type=album)

Сервис успешно пропускает нас, и мы оказываемся перед интерфейсом банкомата. Однако вывести средства по кнопке возможности нет в связи с техническими работами. Попробуем воспользоваться голосовым управлением.

![https://sun9-11.userapi.com/impg/ofxWcb1kMAY_j22ubE_2u260btVZmGX0pDS22Q/FLXOvzbcIUk.jpg?size=807x343&quality=95&sign=f8a4a749662470f314ab725905f0f888&type=album](https://sun9-11.userapi.com/impg/ofxWcb1kMAY_j22ubE_2u260btVZmGX0pDS22Q/FLXOvzbcIUk.jpg?size=807x343&quality=95&sign=f8a4a749662470f314ab725905f0f888&type=album)

В руководстве пользователя находим указанную команду по выводу всех средств – INSTANTLY CASH OUT. После ряда попыток у нас получается добиться распознавания нужной строки, но средства вывести не удается.

![https://sun9-64.userapi.com/impg/cvqS6YkHr6dw2QlnggMSPZ4AlGf2nUZRgqIsfQ/Kk5duI_l2NI.jpg?size=504x591&quality=95&sign=9b0e807f9cd1a50c00aef58eed3ef72a&type=album](https://sun9-64.userapi.com/impg/cvqS6YkHr6dw2QlnggMSPZ4AlGf2nUZRgqIsfQ/Kk5duI_l2NI.jpg?size=504x591&quality=95&sign=9b0e807f9cd1a50c00aef58eed3ef72a&type=album)

Причина заключается в том, что наш голос не похож на голос Генри Кавилла. Попробуем найти образец его голоса в интервью, чтобы затем воспользоваться общедоступной нейронной сетью, например, xtts от huggingface (https://huggingface.co/spaces/coqui/xtts).

![https://sun9-2.userapi.com/impg/RbFhyFuY1NUJbJ2FzutZ0eUR3rlo7qht4Tfg8Q/jb0D8w1Sk00.jpg?size=807x354&quality=95&sign=750b44e04c62181d79a299be221df9b0&type=album](https://sun9-2.userapi.com/impg/RbFhyFuY1NUJbJ2FzutZ0eUR3rlo7qht4Tfg8Q/jb0D8w1Sk00.jpg?size=807x354&quality=95&sign=750b44e04c62181d79a299be221df9b0&type=album)

Скачиваем сгенерированное аудио. Теперь остается отправить запрос с помощью инструмента Burp Suite с нагрузкой данного файла. Для этого переведем содержимое в base64.

![https://sun9-76.userapi.com/impg/RofC_8-p1Gg6bo4olg1cWjA5oOziICorFXV29Q/64kEtYBYrPo.jpg?size=807x219&quality=95&sign=f63beb817ef36a130dcacd6964c7af6a&type=album](https://sun9-76.userapi.com/impg/RofC_8-p1Gg6bo4olg1cWjA5oOziICorFXV29Q/64kEtYBYrPo.jpg?size=807x219&quality=95&sign=f63beb817ef36a130dcacd6964c7af6a&type=album)

Далее вставляем содержимое в тело запроса, отправляем на сервер и – получаем совпадение по смыслу и по голосу говорящего, а вместе с ним и флаг задания.

![https://sun9-17.userapi.com/impg/sg4L05cB5cBfvlh4s31ma9ide1mAjrc59cGPTw/_rJPwal1KrE.jpg?size=807x327&quality=95&sign=0411a1ac398ff32863be4fedb78016ed&type=album](https://sun9-17.userapi.com/impg/sg4L05cB5cBfvlh4s31ma9ide1mAjrc59cGPTw/_rJPwal1KrE.jpg?size=807x327&quality=95&sign=0411a1ac398ff32863be4fedb78016ed&type=album)